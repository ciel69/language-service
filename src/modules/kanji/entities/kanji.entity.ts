import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  ManyToMany,
  JoinTable,
  OneToMany,
  Index,
  Unique,
  ManyToOne,
  JoinColumn,
} from 'typeorm';

import { Word } from '@/modules/word/entities/word.entity';
import { KanjiProgress } from '@/modules/progress/entities/kanji-progress.entity';
import { KanjiPack } from '@/modules/kanji/entities/kanji-pack.entity';

/**
 * –°—É—â–Ω–æ—Å—Ç—å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è —è–ø–æ–Ω—Å–∫–∏–π –∏–µ—Ä–æ–≥–ª–∏—Ñ (–∫–∞–Ω–¥–∑–∏).
 * –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∞–º–æ–º —Å–∏–º–≤–æ–ª–µ, –µ–≥–æ —á—Ç–µ–Ω–∏—è—Ö, –∑–Ω–∞—á–µ–Ω–∏–∏ –∏ —Å–≤—è–∑—è—Ö.
 */
@Entity()
@Unique(['char']) // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Å–∞–º–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –∫–∞–Ω–¥–∑–∏
@Index(['level']) // –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —É—Ä–æ–≤–Ω—é JLPT
export class Kanji {
  /**
   * –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞–Ω–¥–∑–∏.
   */
  @PrimaryGeneratedColumn()
  id: number;

  /**
   * –°–∞–º —Å–∏–º–≤–æ–ª –∫–∞–Ω–¥–∑–∏.
   * @example "‰∏Ä", "‰∫å", "‰∫∫", "Ê∞¥"
   */
  @Column({ type: 'varchar', length: 10, unique: true }) // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –¥–ª–∏–Ω—É –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
  char: string;

  /**
   * –û–Ω-—á—Ç–µ–Ω–∏—è (–æ–Ω—ä—ë–º–∏) –∫–∞–Ω–¥–∑–∏.
   * –ß—Ç–µ–Ω–∏—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤–∞—Ö.
   * @example ["„Ç§„ÉÅ", "„Ç§„ÉÑ"] –¥–ª—è ‰∏Ä
   */
  @Column('simple-array') // –ò—Å–ø–æ–ª—å–∑—É–µ–º simple-array –¥–ª—è –º–∞—Å—Å–∏–≤–∞ —Å—Ç—Ä–æ–∫
  on: string[];

  /**
   * –ö—É–Ω-—á—Ç–µ–Ω–∏—è (–∫—É–Ω—ä—ë–º–∏) –∫–∞–Ω–¥–∑–∏.
   * –Ø–ø–æ–Ω—Å–∫–∏–µ —á—Ç–µ–Ω–∏—è, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –∫–æ–≥–¥–∞ –∫–∞–Ω–¥–∑–∏ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∏–ª–∏ –≤ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö.
   * @example ["„Å≤„Å®", "„Å≤„Å®„Å™"] –¥–ª—è ‰∫∫
   */
  @Column('simple-array') // –ò—Å–ø–æ–ª—å–∑—É–µ–º simple-array –¥–ª—è –º–∞—Å—Å–∏–≤–∞ —Å—Ç—Ä–æ–∫
  kun: string[];

  /**
   * –û—Å–Ω–æ–≤–Ω–æ–µ –∏–ª–∏ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∑–∏.
   * @example "–æ–¥–∏–Ω" –¥–ª—è ‰∏Ä, "—á–µ–ª–æ–≤–µ–∫" –¥–ª—è ‰∫∫
   */
  @Column({ type: 'varchar', length: 500 }) // –£–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑—É–º–Ω—É—é –¥–ª–∏–Ω—É
  meaning: string;

  /**
   * –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ —à–∫–∞–ª–µ JLPT (Japanese Language Proficiency Test).
   * @example 'N5' - —Å–∞–º—ã–π –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å, 'N1' - –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å.
   */
  @Column({
    type: 'enum',
    enum: ['N5', 'N4', 'N3', 'N2', 'N1'],
  })
  level: 'N5' | 'N4' | 'N3' | 'N2' | 'N1';

  /**
   * –°–ª–æ–≤–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ç–æ—Ç –∫–∞–Ω–¥–∑–∏.
   * –°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–æ–º—É –∫–∞–Ω–¥–∑–∏ –±—ã—Ç—å —á–∞—Å—Ç—å—é –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–ª–æ–≤
   * –∏ –æ–¥–Ω–æ–º—É —Å–ª–æ–≤—É —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–∞–Ω–¥–∑–∏.
   */
  @ManyToMany(() => Word, (word) => word.kanji)
  @JoinTable() // –£—Ç–æ—á–Ω—è–µ–º, —á—Ç–æ —ç—Ç–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–∞–±–ª–∏—Ü—É —Å–≤—è–∑–∏
  words: Word[];

  /**
   * –ó–∞–ø–∏—Å–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∏–∑—É—á–µ–Ω–∏—é —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞–Ω–¥–∑–∏.
   * –°–≤—è–∑—å –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º: –æ–¥–∏–Ω –∫–∞–Ω–¥–∑–∏ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   * (–ø–æ –æ–¥–Ω–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ –∏–∑—É—á–∞–µ—Ç).
   */
  @OneToMany(() => KanjiProgress, (progress) => progress.kanji)
  progress: KanjiProgress[];

  /**
   * –°–≤—è–∑—å: –∫–∞–Ω–¥–∑–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ–¥–Ω–æ–º—É –ø–∞–∫—É (–º–æ–∂–µ—Ç –±—ã—Ç—å null).
   */
  @ManyToOne(() => KanjiPack, (pack) => pack.kanji, {
    nullable: true,
    onDelete: 'SET NULL',
  })
  @JoinColumn({ name: 'pack_id' }) // üëà —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –∫–æ–ª–æ–Ω–∫–∏
  pack?: KanjiPack;
}
